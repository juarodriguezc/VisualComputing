<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Aplicación de dibujo 3d con la mano # Introducción # El siguiente trabajo nace depués de observar diferentes proyectos que, haciendo uso de librerías como treegl, logran ser apilcaciones para dibujar en 3 dimensiones. El reto que nos propusimos fue intentar cambiar la interfaz convencional para este tipo de aplicaciones (un mouse) por otra más innovadora como puede ser el caso de nuestra mano, la misma que utilizaban intuitivamente nuestros ancestros para hacer pinturas rupestres."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="Aplicación de dibujo 3d con la mano # Introducción # El siguiente trabajo nace depués de observar diferentes proyectos que, haciendo uso de librerías como treegl, logran ser apilcaciones para dibujar en 3 dimensiones. El reto que nos propusimos fue intentar cambiar la interfaz convencional para este tipo de aplicaciones (un mouse) por otra más innovadora como puede ser el caso de nuestra mano, la misma que utilizaban intuitivamente nuestros ancestros para hacer pinturas rupestres."><meta property="og:type" content="article"><meta property="og:url" content="https://juarodriguezc.github.io/VisualComputing/docs/workshops/coordinate_spaces/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2022-10-20T10:43:43-05:00"><title>Coordinate Spaces | Visual Computing</title><link rel=manifest href=/VisualComputing/manifest.json><link rel=icon href=/VisualComputing/favicon.png type=image/x-icon><link rel=stylesheet href=/VisualComputing/book.min.ab46de3e725a6415339a37bba23a0067534a37289b063c9f8d011515a63097a8.css integrity="sha256-q0bePnJaZBUzmje7ojoAZ1NKNyibBjyfjQEVFaYwl6g=" crossorigin=anonymous><script defer src=/VisualComputing/flexsearch.min.js></script>
<script defer src=/VisualComputing/en.search.min.b4b404ae1e18499f2f86c45c245b4dc1d0889ae8f4608881a3a27bc1785842dc.js integrity="sha256-tLQErh4YSZ8vhsRcJFtNwdCImuj0YIiBo6J7wXhYQtw=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/VisualComputing/><span>Visual Computing</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Workshops</span><ul><li><a href=/VisualComputing/docs/workshops/coordinate_spaces/ class=active>Coordinate Spaces</a></li><li><a href=/VisualComputing/docs/workshops/masking/>Masking</a></li><li><a href=/VisualComputing/docs/workshops/optical_illusions/>Optical Illusions</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/VisualComputing/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Coordinate Spaces</strong>
<label for=toc-control><img src=/VisualComputing/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#aplicación-de-dibujo-3d-con-la-mano>Aplicación de dibujo 3d con la mano</a><ul><li><ul><li><a href=#introducción>Introducción</a></li><li><a href=#detección-de-objetos-con-machine-learning>Detección de Objetos con Machine Learning</a></li><li><a href=#implementación-en-p5>Implementación en P5</a></li><li><a href=#trabajos-futuros>Trabajos futuros</a></li></ul></li><li><a href=#bibliografía>Bibliografía</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=aplicación-de-dibujo-3d-con-la-mano>Aplicación de dibujo 3d con la mano
<a class=anchor href=#aplicaci%c3%b3n-de-dibujo-3d-con-la-mano>#</a></h1><h3 id=introducción>Introducción
<a class=anchor href=#introducci%c3%b3n>#</a></h3><p>El siguiente trabajo nace depués de observar diferentes proyectos que, haciendo uso de librerías como treegl, logran ser apilcaciones para dibujar en 3 dimensiones. El reto que nos propusimos fue intentar cambiar la interfaz convencional para este tipo de aplicaciones (un mouse) por otra más innovadora como puede ser el caso de nuestra mano, la misma que utilizaban intuitivamente nuestros ancestros para hacer pinturas rupestres. Tuvimos la idea de usar la mano aprovechando que en la actualidad existe un gran avance de modelos de inteligencia artificial orientados a <em>detectar</em> objectos (como por ejemplo partes del cuerpo y, por supuesto, la mano).
Para la implementación del ejercicio utilizamos P5 con WEBGL, TreeGL, easyCam (para manejo del canvas 3D) y la librería <a href=https://ml5js.org/>ML5</a> de donde sacamos el modelo de detección de las manos. Adicionalmente implementamos nuestro propio sistema calibrado para, a partir de la detección de la mano, identificar Gestos.
Como guía también utilizamos un <a href="https://www.youtube.com/watch?v=BX8ibqq0MJU">video de YouTube de Kazuki Umeda</a> y encontramos soluciones a diferentes problemas que obtuvimos en foros que están debidamente referenciados en el código.</p><p><img src=https://tripin.travel/wp-content/uploads/2020/02/cueva-de-las-manos-1.jpg alt="Arte rupestre hecho con la mano"></p><h3 id=detección-de-objetos-con-machine-learning>Detección de Objetos con Machine Learning
<a class=anchor href=#detecci%c3%b3n-de-objetos-con-machine-learning>#</a></h3><p>En los últimos años hemos venido presenciando un gran <em>boom</em> en el campo de la inteligencia artificial. Más específicamente, los modelos de Machine Learning (ML) han tomado gran fuerza, ya que muchos hacen uso de un <em>aprendizaje supervizado</em> entrenandolos con grandes cantidades de datos (cosa que en nuestros días hay a montones).
Es tal la tecnología actual, que no son pocas las tareas que modelos de ML pueden resolver, solo por mencionar algunas podemos nombrar:</p><ul><li>Clasificación.</li><li>Regresión.</li><li>Recomendación.</li><li><strong>Detección de Objetos</strong></li></ul><p>Esta última es la que nos atañe en este trabajo. La tarea de detectar e identificar elementos en una imagen o un video está muy bien lograda. Existen varios modelos entrenados de uso libre que ayudan a este trabajo (ejm <em>EfficientDet</em>, <em>COCO</em> etc) que son capaces de detectar y etiquetar miles de posibles objetos.
También existen otros modelos más especializados. Así es el caso de <a href=https://github.com/tensorflow/tfjs-models/tree/master/handpose><em>Handpose</em></a>, el que utilizamos en nuestro trabajo, cuya tarea para que está entrenado es identificar 15 puntos escenciales de una mano en un video.</p><p><img src=https://user-images.githubusercontent.com/43569216/81646758-261df680-946f-11ea-825a-81d8d81abe4e.gif alt="Ejemplo Handpose"></p><h3 id=implementación-en-p5>Implementación en P5
<a class=anchor href=#implementaci%c3%b3n-en-p5>#</a></h3><ul><li>WEBGL</li><li>TreeGL</li><li>esaycam</li><li>ML5</li><li><strong>Aproximación a detección de Gestos:</strong> Con la salida del modelo <em>Handpose</em> intentamos dar una solución para que con esos datos se identificaran gestos. Lo hicimos con estadísticos. Partiendo de la idea que los gestos se pueden diferenciar de acuerdo a distribución estadísitica que tienen los puntos en cada uno de los ejes. Así, si la desviación estandar de los puntos es &ldquo;pequeña&rdquo; (es decir es menor a un umbral) entonces seguramente el gesto de la mano es un puño. Ese umbral se debe calibra de acuerdo a qué tan cerca se esté de la cámara. Para el otro gesto (índice levantado), la idea es similar. Si el punto asociado a la punta del dedo índice está &ldquo;lejos&rdquo; del resto de puntos (es decir está a x-desviaciones estandar de la media) entonces seguramente el indice está levantado. Ese parámetro <em>x</em> también se debe calibrar</li></ul><h3 id=trabajos-futuros>Trabajos futuros
<a class=anchor href=#trabajos-futuros>#</a></h3><p>Pudimos observar que esta propuesta tiene mucho potencial, se pueden agregar más gestos para hacer el editor mucho mas completo gestos como:</p><ul><li>Borrar</li><li>Cambiar de color</li><li>Girar la cámara en más dimensiones.</li></ul><p>También queda pendiente el ejercicio de poder controlar la profundidad de la cámara para dibujar. A pesar de que el modelo da una aproximación de la profundidad de los puntos, se podría mejorar considerablemente.</p><details><summary>Código fuente</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>fbo1</span>, <span style=color:#a6e22e>fbo2</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cam1</span>, <span style=color:#a6e22e>cam2</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>length</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>600</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>hue</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>size</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>foreshortening</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>box</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>handpose</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>detections</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>canvas</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>video</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>gesture</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>last_X_centroid</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; 
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>last_Y_centroid</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>DEFAULT_COLOR</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#00FF00&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>POINTER_COLOR</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;#FFFFFF&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>2</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;#0000FF&#34;</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>points</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>buttonReset</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>createCanvas</span>(<span style=color:#a6e22e>length</span>, <span style=color:#ae81ff>2</span><span style=color:#f92672>*</span><span style=color:#a6e22e>length</span>);
</span></span><span style=display:flex><span>  <span style=color:#75715e>//Create button to delete points
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>buttonReset</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#39;Clear draw&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>buttonReset</span>.<span style=color:#a6e22e>position</span>(<span style=color:#a6e22e>width</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>20</span>, <span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>buttonReset</span>.<span style=color:#a6e22e>mousePressed</span>(<span style=color:#a6e22e>clearDraw</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// frame buffer object instances (FBOs)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>fbo1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#a6e22e>width</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>/</span><span style=color:#ae81ff>4</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#a6e22e>width</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>/</span><span style=color:#ae81ff>4</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>  <span style=color:#75715e>//fbo2.ortho();
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>ortho</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>width</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>width</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>height</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>height</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>10000</span>);
</span></span><span style=display:flex><span>  <span style=color:#75715e>// FBOs cams
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cam1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Dw</span>.<span style=color:#a6e22e>EasyCam</span>(<span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>_renderer</span>, { <span style=color:#a6e22e>distance</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>200</span> });
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>state1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>cam1</span>.<span style=color:#a6e22e>getState</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cam1</span>.<span style=color:#a6e22e>state_reset</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state1</span>;   <span style=color:#75715e>// state to use on reset (double-click/tap)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>cam1</span>.<span style=color:#a6e22e>setViewport</span>([<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>width</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>height</span>]);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cam1</span>.<span style=color:#a6e22e>setPanScale</span>(<span style=color:#ae81ff>0.005</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cam2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Dw</span>.<span style=color:#a6e22e>EasyCam</span>(<span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>_renderer</span>, { <span style=color:#a6e22e>rotation</span><span style=color:#f92672>:</span> [<span style=color:#ae81ff>0.94</span>, <span style=color:#ae81ff>0.33</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>] });
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cam2</span>.<span style=color:#a6e22e>attachMouseListeners</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>state2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>cam2</span>.<span style=color:#a6e22e>getState</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cam2</span>.<span style=color:#a6e22e>state_reset</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state2</span>;   <span style=color:#75715e>// state to use on reset (double-click/tap)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>cam2</span>.<span style=color:#a6e22e>setViewport</span>([<span style=color:#a6e22e>width</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>width</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>height</span>]);
</span></span><span style=display:flex><span>  document.<span style=color:#a6e22e>oncontextmenu</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>; }
</span></span><span style=display:flex><span>  <span style=color:#75715e>// scene
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>print</span>(<span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>distanceToBound</span>([], <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NEAR</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>//HAND POSE RECOGNITION
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>//Code based in Creativeguru97 repo
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// https://github.com/Creativeguru97/YouTube_tutorial/blob/master/Play_with_APIs/hand_detection/ml5_handpose/sketch.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>video</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createCapture</span>(<span style=color:#a6e22e>VIDEO</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>video</span>.<span style=color:#a6e22e>id</span>(<span style=color:#e6db74>&#34;video&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>video</span>.<span style=color:#a6e22e>size</span>(<span style=color:#a6e22e>width</span>, <span style=color:#a6e22e>height</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>video</span>.<span style=color:#a6e22e>hide</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>options</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>flipHorizontal</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>, <span style=color:#75715e>// boolean value for if the video should be flipped, defaults to false
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>maxContinuousChecks</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>Infinity</span>, <span style=color:#75715e>// How many frames to go without running the bounding box detector. Defaults to infinity, but try a lower value if the detector is consistently producing bad predictions.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>detectionConfidence</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.8</span>, <span style=color:#75715e>// Threshold for discarding a prediction. Defaults to 0.8.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>scoreThreshold</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.9</span>, <span style=color:#75715e>// A threshold for removing multiple (likely duplicate) detections based on a &#34;non-maximum suppression&#34; algorithm. Defaults to 0.75
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>iouThreshold</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.3</span>, <span style=color:#75715e>// A float representing the threshold for deciding whether boxes overlap too much in non-maximum suppression. Must be between [0, 1]. Defaults to 0.3.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>handpose</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ml5</span>.<span style=color:#a6e22e>handpose</span>(<span style=color:#a6e22e>video</span>, <span style=color:#a6e22e>options</span>, <span style=color:#a6e22e>modelReady</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>colorMode</span>(<span style=color:#a6e22e>HSB</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>175</span>, <span style=color:#ae81ff>125</span>, <span style=color:#ae81ff>115</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>reset</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>axes</span>({ <span style=color:#a6e22e>size</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>100</span>, <span style=color:#a6e22e>bits</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>X</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>YNEG</span> });
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>grid</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>scene1</span>();
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>detections</span>.<span style=color:#a6e22e>length</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>X</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getXcoordinates</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>X_avg</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>X</span>.<span style=color:#a6e22e>reduce</span>((<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span>) =&gt; <span style=color:#a6e22e>a</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>b</span>, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>/</span> <span style=color:#a6e22e>X</span>.<span style=color:#a6e22e>length</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>Y</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getYcoordinates</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>Y_avg</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Y</span>.<span style=color:#a6e22e>reduce</span>((<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span>) =&gt; <span style=color:#a6e22e>a</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>b</span>, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>/</span> <span style=color:#a6e22e>Y</span>.<span style=color:#a6e22e>length</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>gesture</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>defineGesture</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>gesture</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>){
</span></span><span style=display:flex><span>      <span style=color:#75715e>//Añade los puntos a un arreglo
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>points</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>detections</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>annotations</span>.<span style=color:#a6e22e>indexFinger</span>[<span style=color:#ae81ff>2</span>]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>gesture</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span>){
</span></span><span style=display:flex><span>      <span style=color:#75715e>//ROTA CAMARA
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>cam1</span>.<span style=color:#a6e22e>rotateY</span>((<span style=color:#a6e22e>X_avg</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>last_X_centroid</span>)<span style=color:#f92672>/</span><span style=color:#ae81ff>50</span>)
</span></span><span style=display:flex><span>      <span style=color:#75715e>//Para rotar también en Y
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#75715e>//cam1.rotateX((Y_avg - last_Y_centroid)/50)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>last_X_centroid</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>X_avg</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>last_Y_centroid</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Y_avg</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>beginHUD</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>image</span>(<span style=color:#a6e22e>fbo1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>endHUD</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>//gesto 2: gira la cámara con el puño cerrado
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>130</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>reset</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>axes</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>grid</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>scene2</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>strokeWeight</span>(<span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>255</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>viewFrustum</span>({ <span style=color:#a6e22e>fbo</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>fbo1</span>, <span style=color:#a6e22e>bits</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>BODY</span> });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>beginHUD</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>image</span>(<span style=color:#a6e22e>fbo2</span>, <span style=color:#a6e22e>width</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>endHUD</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>//CAMERA
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>translate</span>(<span style=color:#a6e22e>width</span>,<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>scale</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>image</span>(<span style=color:#a6e22e>video</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>/</span><span style=color:#ae81ff>4</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>drawPredictions</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>clearDraw</span>(){
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>points</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>scene1</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>vis</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>visibility</span>(<span style=color:#a6e22e>box</span> <span style=color:#f92672>?</span> { <span style=color:#a6e22e>corner1</span><span style=color:#f92672>:</span> [<span style=color:#f92672>-</span><span style=color:#a6e22e>size</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>size</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>size</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>], <span style=color:#a6e22e>corner2</span><span style=color:#f92672>:</span> [<span style=color:#a6e22e>size</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>size</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>size</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>] } <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    { <span style=color:#a6e22e>center</span><span style=color:#f92672>:</span> [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>], <span style=color:#a6e22e>radius</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>size</span> });
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>hue</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vis</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>VISIBLE</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;green&#39;</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>vis</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SEMIVISIBLE</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;blue&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;red&#39;</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>fill</span>(<span style=color:#a6e22e>hue</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>  <span style=color:#75715e>//box ? fbo1.box(size) : fbo1.sphere(size);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>strokeWeight</span>(<span style=color:#ae81ff>0.1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>stroke</span>(<span style=color:#e6db74>&#34;#FFFFFF&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#75715e>//fbo2.grid({ dotted: true });
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>  <span style=color:#75715e>//fbo2.axes();
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>//for (const point of points) {
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>//Draw the points saved in the array
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>points</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>brushCanvas</span>(<span style=color:#a6e22e>points</span>[<span style=color:#a6e22e>i</span>]);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>//Draw the guide point if the hand is detected
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>detections</span>.<span style=color:#a6e22e>length</span>){  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>brushCanvas</span>(<span style=color:#a6e22e>detections</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>annotations</span>.<span style=color:#a6e22e>indexFinger</span>[<span style=color:#ae81ff>2</span>], <span style=color:#a6e22e>POINTER_COLOR</span>[<span style=color:#a6e22e>gesture</span>] <span style=color:#f92672>||</span> <span style=color:#a6e22e>DEFAULT_COLOR</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>scene2</span>() {
</span></span><span style=display:flex><span>  <span style=color:#75715e>//fbo2.fill(hue);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>//fbo2.noStroke();
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>//box ? fbo2.box(size) : fbo2.sphere(size);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>//Draw the points saved in the array
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>points</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>brushCanvasFbo2</span>(<span style=color:#a6e22e>points</span>[<span style=color:#a6e22e>i</span>]);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>keyPressed</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>key</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;p&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>foreshortening</span> <span style=color:#f92672>=</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>foreshortening</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>eyeZ</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>height</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>/</span> <span style=color:#a6e22e>tan</span>(<span style=color:#a6e22e>PI</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>6</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>foreshortening</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>perspective</span>(<span style=color:#a6e22e>PI</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>3</span>, <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>width</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>height</span>, <span style=color:#a6e22e>eyeZ</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>eyeZ</span>) <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>ortho</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>width</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>width</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>height</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>height</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>500</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>  if (key === &#39;b&#39;) {
</span></span></span><span style=display:flex><span><span style=color:#75715e>    box = !box;
</span></span></span><span style=display:flex><span><span style=color:#75715e>  }
</span></span></span><span style=display:flex><span><span style=color:#75715e>  */</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>brushCanvas</span>(<span style=color:#a6e22e>point</span>, <span style=color:#a6e22e>color</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;#FFFFFF&#34;</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#a6e22e>point</span>[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>/</span><span style=color:#ae81ff>1.8</span><span style=color:#f92672>-</span><span style=color:#a6e22e>width</span><span style=color:#f92672>/</span><span style=color:#ae81ff>4</span>, <span style=color:#a6e22e>point</span>[<span style=color:#ae81ff>1</span>]<span style=color:#f92672>-</span><span style=color:#a6e22e>height</span><span style=color:#f92672>/</span><span style=color:#ae81ff>8</span>, <span style=color:#a6e22e>point</span>[<span style=color:#ae81ff>2</span>]);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>fill</span>(<span style=color:#a6e22e>color</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>sphere</span>(<span style=color:#ae81ff>8</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>brushCanvasFbo2</span>(<span style=color:#a6e22e>point</span>, <span style=color:#a6e22e>color</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;#FFFFFF&#34;</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#a6e22e>point</span>[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>/</span><span style=color:#ae81ff>1.8</span><span style=color:#f92672>-</span><span style=color:#a6e22e>width</span><span style=color:#f92672>/</span><span style=color:#ae81ff>4</span>, <span style=color:#a6e22e>point</span>[<span style=color:#ae81ff>1</span>]<span style=color:#f92672>-</span><span style=color:#a6e22e>height</span><span style=color:#f92672>/</span><span style=color:#ae81ff>8</span>, <span style=color:#a6e22e>point</span>[<span style=color:#ae81ff>2</span>]);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>fill</span>(<span style=color:#a6e22e>color</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>sphere</span>(<span style=color:#ae81ff>8</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo2</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>modelReady</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Model ready!&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>handpose</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;predict&#39;</span>, <span style=color:#a6e22e>results</span> =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>detections</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>results</span>;
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>drawPredictions</span>(){
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>/</span><span style=color:#ae81ff>4</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>detections</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>){
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>drawLandmarks</span>([<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>], <span style=color:#ae81ff>0</span>);<span style=color:#75715e>//palm base
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>drawLandmarks</span>([<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>5</span>], <span style=color:#ae81ff>60</span>);<span style=color:#75715e>//thumb
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>drawLandmarks</span>([<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>9</span>], <span style=color:#ae81ff>120</span>);<span style=color:#75715e>//index finger
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>drawLandmarks</span>([<span style=color:#ae81ff>9</span>, <span style=color:#ae81ff>13</span>], <span style=color:#ae81ff>180</span>);<span style=color:#75715e>//middle finger
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>drawLandmarks</span>([<span style=color:#ae81ff>13</span>, <span style=color:#ae81ff>17</span>], <span style=color:#ae81ff>240</span>);<span style=color:#75715e>//ring finger
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>drawLandmarks</span>([<span style=color:#ae81ff>17</span>, <span style=color:#ae81ff>21</span>], <span style=color:#ae81ff>300</span>);<span style=color:#75715e>//pinky
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>drawLandmarks</span>(<span style=color:#a6e22e>indexArray</span>, <span style=color:#a6e22e>hue</span>){
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>noFill</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>strokeWeight</span>(<span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>detections</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span><span style=color:#f92672>=</span><span style=color:#a6e22e>indexArray</span>[<span style=color:#ae81ff>0</span>]; <span style=color:#a6e22e>j</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>indexArray</span>[<span style=color:#ae81ff>1</span>]; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>detections</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>landmarks</span>[<span style=color:#a6e22e>j</span>][<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>detections</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>landmarks</span>[<span style=color:#a6e22e>j</span>][<span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>z</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>detections</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>landmarks</span>[<span style=color:#a6e22e>j</span>][<span style=color:#ae81ff>2</span>];
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>stroke</span>(<span style=color:#a6e22e>hue</span>, <span style=color:#ae81ff>40</span>, <span style=color:#ae81ff>255</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>point</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>defineGesture</span>(){
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>X</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getXcoordinates</span>()
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>X_std</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getStandardDeviation</span>(<span style=color:#a6e22e>X</span>)
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>X_range</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>max</span>(...<span style=color:#a6e22e>X</span>) <span style=color:#f92672>-</span> Math.<span style=color:#a6e22e>min</span>(...<span style=color:#a6e22e>X</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>Y</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getYcoordinates</span>()
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>Y_std</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getStandardDeviation</span>(<span style=color:#a6e22e>Y</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>Y_avg</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Y</span>.<span style=color:#a6e22e>reduce</span>((<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span>) =&gt; <span style=color:#a6e22e>a</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>b</span>, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>/</span> <span style=color:#a6e22e>Y</span>.<span style=color:#a6e22e>length</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>Y_range</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>max</span>(...<span style=color:#a6e22e>Y</span>) <span style=color:#f92672>-</span> Math.<span style=color:#a6e22e>min</span>(...<span style=color:#a6e22e>Y</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>index_X_top</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>detections</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>landmarks</span>[<span style=color:#ae81ff>8</span>][<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>index_Y_top</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>detections</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>landmarks</span>[<span style=color:#ae81ff>8</span>][<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>X_std</span>, <span style=color:#a6e22e>Y_std</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Range X&#34;</span>, <span style=color:#a6e22e>X_range</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Range Y&#34;</span>, <span style=color:#a6e22e>Y_range</span>);
</span></span><span style=display:flex><span>  <span style=color:#75715e>// stretched index
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span>( (Math.<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>index_Y_top</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>Y_avg</span>) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1.5</span><span style=color:#f92672>*</span><span style=color:#a6e22e>Y_std</span>) ){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Fist
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>X_std</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>50</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>Y_std</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>50</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>Y_range</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>180</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getXcoordinates</span>(){
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>detections</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>landmarks</span>.<span style=color:#a6e22e>map</span>(<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>x</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>x</span>[<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getYcoordinates</span>(){
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>detections</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>landmarks</span>.<span style=color:#a6e22e>map</span>(<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>x</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>x</span>[<span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getStandardDeviation</span> (<span style=color:#a6e22e>array</span>) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>//Función tomada de stackoverflow
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>//https://stackoverflow.com/questions/7343890/standard-deviation-javascript
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>n</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>array</span>.<span style=color:#a6e22e>length</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>mean</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>array</span>.<span style=color:#a6e22e>reduce</span>((<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span>) =&gt; <span style=color:#a6e22e>a</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>b</span>) <span style=color:#f92672>/</span> <span style=color:#a6e22e>n</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> Math.<span style=color:#a6e22e>sqrt</span>(<span style=color:#a6e22e>array</span>.<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>x</span> =&gt; Math.<span style=color:#a6e22e>pow</span>(<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>mean</span>, <span style=color:#ae81ff>2</span>)).<span style=color:#a6e22e>reduce</span>((<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span>) =&gt; <span style=color:#a6e22e>a</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>b</span>) <span style=color:#f92672>/</span> <span style=color:#a6e22e>n</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></details><iframe id=sketch style=width:700px;height:1000px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/addons/p5.sound.min.js></script>
             <script src=https://cdn.jsdelivr.net/gh/VisualComputing/p5.treegl/p5.treegl.js></script> 
             <script src=https://cdn.jsdelivr.net/gh/freshfork/p5.EasyCam@1.2.1/p5.easycam.js></script> 
             <script src=https://cdn.jsdelivr.net/gh/VisualComputing/p5.treegl/p5treegl.js></script> 
             <script src=https://unpkg.com/ml5@latest/dist/ml5.min.js></script> 
            
            <script src=/VisualComputing/sketches/workshop2/sketch.js></script>
          </head>
          <body>
          </body>
        </html>
      "></iframe><h2 id=bibliografía>Bibliografía
<a class=anchor href=#bibliograf%c3%ada>#</a></h2><ul><li>[Multiple Hands Detection in p5.js, Kazuki Umeda YouTube](<a href="https://michaelbach.de/ot/mot-feetLin/]%28https://www.youtube.com/watch?v=BX8ibqq0MJU%29">https://michaelbach.de/ot/mot-feetLin/](https://www.youtube.com/watch?v=BX8ibqq0MJU)</a>
[<a href=https://github.com/Creativeguru97/YouTube_tutorial/tree/master/Play_with_APIs/hand_detection/ml5_handpose>Multiple Hands Detection in p5.js, Kazuki Umeda Repo</a></li><li><a href=https://learn.ml5js.org/#/reference/index>ML5 Reference</a></li><li><a href=https://visualcomputing.github.io/>Visual Computing Course Page</a></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/visualcomputing/showcase/commit/7f4f08821247481d9908afae71838f8db408c849 title='Last modified by Leonardo Delgado | October 20, 2022' target=_blank rel=noopener><img src=/VisualComputing/svg/calendar.svg class=book-icon alt=Calendar>
<span>October 20, 2022</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#aplicación-de-dibujo-3d-con-la-mano>Aplicación de dibujo 3d con la mano</a><ul><li><ul><li><a href=#introducción>Introducción</a></li><li><a href=#detección-de-objetos-con-machine-learning>Detección de Objetos con Machine Learning</a></li><li><a href=#implementación-en-p5>Implementación en P5</a></li><li><a href=#trabajos-futuros>Trabajos futuros</a></li></ul></li><li><a href=#bibliografía>Bibliografía</a></li></ul></li></ul></nav></div></aside></main></body></html>